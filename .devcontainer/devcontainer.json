// See https://aka.ms/vscode-remote/devcontainer.json for format details.
{
  "image": "ghcr.io/jmservera/baseros/jazzy:sim",
  // Uncomment the next block if you want to modify the container created by building the Dockerfile
  // "dockerFile": "Dockerfile.sim",
  // "build": {
  //   "args": {
  //     "ROS_DISTRO": "jazzy",
  //     "USERNAME": "ros_user"
  //   }
  // },
  "context": ".",
  "remoteUser": "ros_user",
  "initializeCommand": "xhost +local:docker || true",
  "postCreateCommand": "cp -rn ~/.gnupg-host/* ~/.gnupg/ 2>/dev/null; cp -rn ~/.gnupg-host/private-keys-v1.d/* ~/.gnupg/private-keys-v1.d/ 2>/dev/null; echo 'pinentry-program /usr/bin/pinentry-curses' > ~/.gnupg/gpg-agent.conf && gpgconf --kill gpg-agent 2>/dev/null; /usr/local/bin/build_ws",
  "runArgs": [
    "--name=ros2_devcontainer", // sets the name of the container
    "--network=host", // allows the container to access the host network
    "--cap-add=SYS_PTRACE", // adds the ability to use ptrace for debugging
    "--security-opt=seccomp:unconfined", // allows the container to run without a security profile for debugging
    "--security-opt=apparmor:unconfined", // allows the container more access to the host network
    "--volume=/tmp/.X11-unix:/tmp/.X11-unix", // Only needed on linux, Comment if you are on Windows
    "--mount",
    "type=bind,source=${localWorkspaceFolder}/src/,target=/home/ros_user/ros2_ws/src", // mount the ros2_src folder into the container
    // "--gpus=all", // this is needed for hardware acceleration on nvidia gpus
    "--volume=/mnt/wslg:/mnt/wslg", // uncomment to use wslg
    "--ipc=host", // allow the container to share the same Inter-Process Communcation (IPC) namespace as the host
    "--device=/dev/dri", // uncomment to use intel iGPU
    "--volume=${localEnv:HOME}/.gnupg:/home/ros_user/.gnupg-host:ro" // mount host GPG keyring for commit signing
  ],
  "containerEnv": {
    "DISPLAY": "${localEnv:DISPLAY}", // Needed for GUI try ":0" for windows
    "WAYLAND_DISPLAY": "${localEnv:WAYLAND_DISPLAY}",
    "XDG_RUNTIME_DIR": "${localEnv:XDG_RUNTIME_DIR}",
    "PULSE_SERVER": "${localEnv:PULSE_SERVER}",
    "ROS_AUTOMATIC_DISCOVERY_RANGE": "LOCALHOST",
    "GPG_TTY": "/dev/pts/0" // Needed for GPG passphrase prompt in terminal
    // uncomment if you are on ARM architecture
    // "LIBGL_ALWAYS_SOFTWARE": "1" // Needed for software rendering of opengl
  },
  // Set *default* container specific settings.json values on container create.
  "customizations": {
    "vscode": {
      "extensions": [
        "betwo.b2-catkin-tools",
        "DotJoshJohnson.xml",
        "ms-azuretools.vscode-docker",
        "ms-python.python",
        "ms-vscode.cpptools",
        "redhat.vscode-yaml",
        "streetsidesoftware.code-spell-checker",
        "twxs.cmake",
        "yzhang.markdown-all-in-one",
        "zachflower.uncrustify",
        "Ranch-Hand-Robotics.rde-ros-2",
        "Ranch-Hand-Robotics.urdf-editor"
      ]
    }
  }
}
